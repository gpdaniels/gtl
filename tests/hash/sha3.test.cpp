/*
Copyright (C) 2018-2024 Geoffrey Daniels. https://gpdaniels.com/

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, version 3 of the License only.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <https://www.gnu.org/licenses/>.
*/

#include <testbench/main.tests.hpp>

#include <testbench/comparison.tests.hpp>
#include <testbench/optimise.tests.hpp>
#include <testbench/require.tests.hpp>
#include <testbench/template.tests.hpp>

#include <hash/sha3>

#if defined(_MSC_VER)
#pragma warning(push, 0)
#endif

#include <cstdio>
#include <type_traits>

#if defined(_MSC_VER)
#pragma warning(pop)
#endif

using sha3_types = testbench::value_collection<224, 256, 384, 512>;

TEST(sha3, traits, standard) {
    testbench::test_template<sha3_types>(
        [](auto test_value) -> void {
            constexpr static const unsigned long long int value = decltype(test_value)::value;

            REQUIRE((std::is_pod<gtl::sha3<value>>::value == false));

            REQUIRE((std::is_trivial<gtl::sha3<value>>::value == false));

            REQUIRE((std::is_trivially_copyable<gtl::sha3<value>>::value == true));

            REQUIRE((std::is_standard_layout<gtl::sha3<value>>::value == true));
        }
    );
}

TEST(sha3, constructor, empty) {
    testbench::test_template<sha3_types>(
        [](auto test_value) -> void {
            constexpr static const unsigned long long int value = decltype(test_value)::value;

            gtl::sha3<value> sha3;
            testbench::do_not_optimise_away(sha3);
        }
    );
}

TEST(sha3, function, reset) {
    testbench::test_template<sha3_types>(
        [](auto test_value) -> void {
            constexpr static const unsigned long long int value = decltype(test_value)::value;

            gtl::sha3<value> sha3;
            sha3.reset();
        }
    );
}

TEST(sha3, function, consume) {
    testbench::test_template<sha3_types>(
        [](auto test_value) -> void {
            constexpr static const unsigned long long int value = decltype(test_value)::value;

            gtl::sha3<value> sha3;
            sha3.consume("", 0);
            sha3.consume("123456781234567812345678123456781234567812345678123456781234567", 63);
            sha3.consume("1234567812345678123456781234567812345678123456781234567812345678", 64);
            sha3.consume("12345678123456781234567812345678123456781234567812345678123456781", 65);
        }
    );
}

TEST(sha3, function, finalise) {
    testbench::test_template<sha3_types>(
        [](auto test_value) -> void {
            constexpr static const unsigned long long int value = decltype(test_value)::value;

            gtl::sha3<value> sha3;
            sha3.finalise();
        }
    );
}

TEST(sha3, function, get_hash) {
    testbench::test_template<sha3_types>(
        [](auto test_value) -> void {
            constexpr static const unsigned long long int value = decltype(test_value)::value;

            gtl::sha3<value> sha3;
            sha3.finalise();
            sha3.get_hash();
        }
    );
}

TEST(sha3, function, hash) {
    testbench::test_template<sha3_types>(
        [](auto test_value) -> void {
            constexpr static const unsigned long long int value = decltype(test_value)::value;
            gtl::sha3<value>::hash("", 0);
            gtl::sha3<value>::hash("123456781234567812345678123456781234567812345678123456781234567", 63);
            gtl::sha3<value>::hash("1234567812345678123456781234567812345678123456781234567812345678", 64);
            gtl::sha3<value>::hash("12345678123456781234567812345678123456781234567812345678123456781", 65);
        }
    );
}

TEST(sha3, evaluate, hash_as_integer) {
    constexpr static const unsigned int data_count = 7;

    constexpr static const char* data[data_count] = {
        "",
        "a",
        "abc",
        "message digest",
        "abcdefghijklmnopqrstuvwxyz",
        "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",
        "12345678901234567890123456789012345678901234567890123456789012345678901234567890"
    };
    UNUSED(data);

    constexpr static const unsigned char result_sha3_224[data_count][gtl::sha3<224>::hash_size] = {
        { 0x6B, 0x4E, 0x03, 0x42, 0x36, 0x67, 0xDB, 0xB7, 0x3B, 0x6E, 0x15, 0x45, 0x4F, 0x0E, 0xB1, 0xAB, 0xD4, 0x59, 0x7F, 0x9A, 0x1B, 0x07, 0x8E, 0x3F, 0x5B, 0x5A, 0x6B, 0xC7 },
        { 0x9E, 0x86, 0xFF, 0x69, 0x55, 0x7C, 0xA9, 0x5F, 0x40, 0x5F, 0x08, 0x12, 0x69, 0x68, 0x5B, 0x38, 0xE3, 0xA8, 0x19, 0xB3, 0x09, 0xEE, 0x94, 0x2F, 0x48, 0x2B, 0x6A, 0x8B },
        { 0xE6, 0x42, 0x82, 0x4C, 0x3F, 0x8C, 0xF2, 0x4A, 0xD0, 0x92, 0x34, 0xEE, 0x7D, 0x3C, 0x76, 0x6F, 0xC9, 0xA3, 0xA5, 0x16, 0x8D, 0x0C, 0x94, 0xAD, 0x73, 0xB4, 0x6F, 0xDF },
        { 0x18, 0x76, 0x8B, 0xB4, 0xC4, 0x8E, 0xB7, 0xFC, 0x88, 0xE5, 0xDD, 0xB1, 0x7E, 0xFC, 0xF2, 0x96, 0x4A, 0xBD, 0x77, 0x98, 0xA3, 0x9D, 0x86, 0xA4, 0xB4, 0xA1, 0xE4, 0xC8 },
        { 0x5C, 0xDE, 0xCA, 0x81, 0xE1, 0x23, 0xF8, 0x7C, 0xAD, 0x96, 0xB9, 0xCB, 0xA9, 0x99, 0xF1, 0x6F, 0x6D, 0x41, 0x54, 0x96, 0x08, 0xD4, 0xE0, 0xF4, 0x68, 0x1B, 0x82, 0x39 },
        { 0xA6, 0x7C, 0x28, 0x9B, 0x82, 0x50, 0xA6, 0xF4, 0x37, 0xA2, 0x01, 0x37, 0x98, 0x5D, 0x60, 0x55, 0x89, 0xA8, 0xC1, 0x63, 0xD4, 0x52, 0x61, 0xB1, 0x54, 0x19, 0x55, 0x6E },
        { 0x05, 0x26, 0x89, 0x8E, 0x18, 0x58, 0x69, 0xF9, 0x1B, 0x3E, 0x2A, 0x76, 0xDD, 0x72, 0xA1, 0x5D, 0xC6, 0x94, 0x0A, 0x67, 0xC8, 0x16, 0x4A, 0x04, 0x4C, 0xD2, 0x5C, 0xC8 }
    };
    UNUSED(result_sha3_224);

    constexpr static const unsigned char result_sha3_256[data_count][gtl::sha3<256>::hash_size] = {
        { 0xA7, 0xFF, 0xC6, 0xF8, 0xBF, 0x1E, 0xD7, 0x66, 0x51, 0xC1, 0x47, 0x56, 0xA0, 0x61, 0xD6, 0x62, 0xF5, 0x80, 0xFF, 0x4D, 0xE4, 0x3B, 0x49, 0xFA, 0x82, 0xD8, 0x0A, 0x4B, 0x80, 0xF8, 0x43, 0x4A },
        { 0x80, 0x08, 0x4B, 0xF2, 0xFB, 0xA0, 0x24, 0x75, 0x72, 0x6F, 0xEB, 0x2C, 0xAB, 0x2D, 0x82, 0x15, 0xEA, 0xB1, 0x4B, 0xC6, 0xBD, 0xD8, 0xBF, 0xB2, 0xC8, 0x15, 0x12, 0x57, 0x03, 0x2E, 0xCD, 0x8B },
        { 0x3A, 0x98, 0x5D, 0xA7, 0x4F, 0xE2, 0x25, 0xB2, 0x04, 0x5C, 0x17, 0x2D, 0x6B, 0xD3, 0x90, 0xBD, 0x85, 0x5F, 0x08, 0x6E, 0x3E, 0x9D, 0x52, 0x5B, 0x46, 0xBF, 0xE2, 0x45, 0x11, 0x43, 0x15, 0x32 },
        { 0xED, 0xCD, 0xB2, 0x06, 0x93, 0x66, 0xE7, 0x52, 0x43, 0x86, 0x0C, 0x18, 0xC3, 0xA1, 0x14, 0x65, 0xEC, 0xA3, 0x4B, 0xCE, 0x61, 0x43, 0xD3, 0x0C, 0x86, 0x65, 0xCE, 0xFC, 0xFD, 0x32, 0xBF, 0xFD },
        { 0x7C, 0xAB, 0x2D, 0xC7, 0x65, 0xE2, 0x1B, 0x24, 0x1D, 0xBC, 0x1C, 0x25, 0x5C, 0xE6, 0x20, 0xB2, 0x9F, 0x52, 0x7C, 0x6D, 0x5E, 0x7F, 0x5F, 0x84, 0x3E, 0x56, 0x28, 0x8F, 0x0D, 0x70, 0x75, 0x21 },
        { 0xA7, 0x9D, 0x6A, 0x9D, 0xA4, 0x7F, 0x04, 0xA3, 0xB9, 0xA9, 0x32, 0x3E, 0xC9, 0x99, 0x1F, 0x21, 0x05, 0xD4, 0xC7, 0x8A, 0x7B, 0xC7, 0xBE, 0xEB, 0x10, 0x38, 0x55, 0xA7, 0xA1, 0x1D, 0xFB, 0x9F },
        { 0x29, 0x3E, 0x5C, 0xE4, 0xCE, 0x54, 0xEE, 0x71, 0x99, 0x0A, 0xB0, 0x6E, 0x51, 0x1B, 0x7C, 0xCD, 0x62, 0x72, 0x2B, 0x1B, 0xEB, 0x41, 0x4F, 0x5F, 0xF6, 0x5C, 0x82, 0x74, 0xE0, 0xF5, 0xBE, 0x1D }
    };
    UNUSED(result_sha3_256);

    constexpr static const unsigned char result_sha3_384[data_count][gtl::sha3<384>::hash_size] = {
        { 0x0C, 0x63, 0xA7, 0x5B, 0x84, 0x5E, 0x4F, 0x7D, 0x01, 0x10, 0x7D, 0x85, 0x2E, 0x4C, 0x24, 0x85, 0xC5, 0x1A, 0x50, 0xAA, 0xAA, 0x94, 0xFC, 0x61, 0x99, 0x5E, 0x71, 0xBB, 0xEE, 0x98, 0x3A, 0x2A, 0xC3, 0x71, 0x38, 0x31, 0x26, 0x4A, 0xDB, 0x47, 0xFB, 0x6B, 0xD1, 0xE0, 0x58, 0xD5, 0xF0, 0x04 },
        { 0x18, 0x15, 0xF7, 0x74, 0xF3, 0x20, 0x49, 0x1B, 0x48, 0x56, 0x9E, 0xFE, 0xC7, 0x94, 0xD2, 0x49, 0xEE, 0xB5, 0x9A, 0xAE, 0x46, 0xD2, 0x2B, 0xF7, 0x7D, 0xAF, 0xE2, 0x5C, 0x5E, 0xDC, 0x28, 0xD7, 0xEA, 0x44, 0xF9, 0x3E, 0xE1, 0x23, 0x4A, 0xA8, 0x8F, 0x61, 0xC9, 0x19, 0x12, 0xA4, 0xCC, 0xD9 },
        { 0xEC, 0x01, 0x49, 0x82, 0x88, 0x51, 0x6F, 0xC9, 0x26, 0x45, 0x9F, 0x58, 0xE2, 0xC6, 0xAD, 0x8D, 0xF9, 0xB4, 0x73, 0xCB, 0x0F, 0xC0, 0x8C, 0x25, 0x96, 0xDA, 0x7C, 0xF0, 0xE4, 0x9B, 0xE4, 0xB2, 0x98, 0xD8, 0x8C, 0xEA, 0x92, 0x7A, 0xC7, 0xF5, 0x39, 0xF1, 0xED, 0xF2, 0x28, 0x37, 0x6D, 0x25 },
        { 0xD9, 0x51, 0x97, 0x09, 0xF4, 0x4A, 0xF7, 0x3E, 0x2C, 0x8E, 0x29, 0x11, 0x09, 0xA9, 0x79, 0xDE, 0x3D, 0x61, 0xDC, 0x02, 0xBF, 0x69, 0xDE, 0xF7, 0xFB, 0xFF, 0xDF, 0xFF, 0xE6, 0x62, 0x75, 0x15, 0x13, 0xF1, 0x9A, 0xD5, 0x7E, 0x17, 0xD4, 0xB9, 0x3B, 0xA1, 0xE4, 0x84, 0xFC, 0x19, 0x80, 0xD5 },
        { 0xFE, 0xD3, 0x99, 0xD2, 0x21, 0x7A, 0xAF, 0x4C, 0x71, 0x7A, 0xD0, 0xC5, 0x10, 0x2C, 0x15, 0x58, 0x9E, 0x1C, 0x99, 0x0C, 0xC2, 0xB9, 0xA5, 0x02, 0x90, 0x56, 0xA7, 0xF7, 0x48, 0x58, 0x88, 0xD6, 0xAB, 0x65, 0xDB, 0x23, 0x70, 0x07, 0x7A, 0x5C, 0xAD, 0xB5, 0x3F, 0xC9, 0x28, 0x0D, 0x27, 0x8F },
        { 0xD5, 0xB9, 0x72, 0x30, 0x2F, 0x50, 0x80, 0xD0, 0x83, 0x0E, 0x0D, 0xE7, 0xB6, 0xB2, 0xCF, 0x38, 0x36, 0x65, 0xA0, 0x08, 0xF4, 0xC4, 0xF3, 0x86, 0xA6, 0x11, 0x12, 0x65, 0x2C, 0x74, 0x2D, 0x20, 0xCB, 0x45, 0xAA, 0x51, 0xBD, 0x4F, 0x54, 0x2F, 0xC7, 0x33, 0xE2, 0x71, 0x9E, 0x99, 0x92, 0x91 },
        { 0x3C, 0x21, 0x3A, 0x17, 0xF5, 0x14, 0x63, 0x8A, 0xCB, 0x3B, 0xF1, 0x7F, 0x10, 0x9F, 0x3E, 0x24, 0xC1, 0x6F, 0x9F, 0x14, 0xF0, 0x85, 0xB5, 0x2A, 0x2F, 0x2B, 0x81, 0xAD, 0xC0, 0xDB, 0x83, 0xDF, 0x1A, 0x58, 0xDB, 0x2C, 0xE0, 0x13, 0x19, 0x1B, 0x8B, 0xA7, 0x2D, 0x8F, 0xAE, 0x7E, 0x2A, 0x5E }
    };
    UNUSED(result_sha3_384);

    constexpr static const unsigned char result_sha3_512[data_count][gtl::sha3<512>::hash_size] = {
        { 0xA6, 0x9F, 0x73, 0xCC, 0xA2, 0x3A, 0x9A, 0xC5, 0xC8, 0xB5, 0x67, 0xDC, 0x18, 0x5A, 0x75, 0x6E, 0x97, 0xC9, 0x82, 0x16, 0x4F, 0xE2, 0x58, 0x59, 0xE0, 0xD1, 0xDC, 0xC1, 0x47, 0x5C, 0x80, 0xA6, 0x15, 0xB2, 0x12, 0x3A, 0xF1, 0xF5, 0xF9, 0x4C, 0x11, 0xE3, 0xE9, 0x40, 0x2C, 0x3A, 0xC5, 0x58, 0xF5, 0x00, 0x19, 0x9D, 0x95, 0xB6, 0xD3, 0xE3, 0x01, 0x75, 0x85, 0x86, 0x28, 0x1D, 0xCD, 0x26 },
        { 0x69, 0x7F, 0x2D, 0x85, 0x61, 0x72, 0xCB, 0x83, 0x09, 0xD6, 0xB8, 0xB9, 0x7D, 0xAC, 0x4D, 0xE3, 0x44, 0xB5, 0x49, 0xD4, 0xDE, 0xE6, 0x1E, 0xDF, 0xB4, 0x96, 0x2D, 0x86, 0x98, 0xB7, 0xFA, 0x80, 0x3F, 0x4F, 0x93, 0xFF, 0x24, 0x39, 0x35, 0x86, 0xE2, 0x8B, 0x5B, 0x95, 0x7A, 0xC3, 0xD1, 0xD3, 0x69, 0x42, 0x0C, 0xE5, 0x33, 0x32, 0x71, 0x2F, 0x99, 0x7B, 0xD3, 0x36, 0xD0, 0x9A, 0xB0, 0x2A },
        { 0xB7, 0x51, 0x85, 0x0B, 0x1A, 0x57, 0x16, 0x8A, 0x56, 0x93, 0xCD, 0x92, 0x4B, 0x6B, 0x09, 0x6E, 0x08, 0xF6, 0x21, 0x82, 0x74, 0x44, 0xF7, 0x0D, 0x88, 0x4F, 0x5D, 0x02, 0x40, 0xD2, 0x71, 0x2E, 0x10, 0xE1, 0x16, 0xE9, 0x19, 0x2A, 0xF3, 0xC9, 0x1A, 0x7E, 0xC5, 0x76, 0x47, 0xE3, 0x93, 0x40, 0x57, 0x34, 0x0B, 0x4C, 0xF4, 0x08, 0xD5, 0xA5, 0x65, 0x92, 0xF8, 0x27, 0x4E, 0xEC, 0x53, 0xF0 },
        { 0x34, 0x44, 0xE1, 0x55, 0x88, 0x1F, 0xA1, 0x55, 0x11, 0xF5, 0x77, 0x26, 0xC7, 0xD7, 0xCF, 0xE8, 0x03, 0x02, 0xA7, 0x43, 0x30, 0x67, 0xB2, 0x9D, 0x59, 0xA7, 0x14, 0x15, 0xCA, 0x9D, 0xD1, 0x41, 0xAC, 0x89, 0x2D, 0x31, 0x0B, 0xC4, 0xD7, 0x81, 0x28, 0xC9, 0x8F, 0xDA, 0x83, 0x9D, 0x18, 0xD7, 0xF0, 0x55, 0x6F, 0x2F, 0xE7, 0xAC, 0xB3, 0xC0, 0xCD, 0xA4, 0xBF, 0xF3, 0xA2, 0x5F, 0x5F, 0x59 },
        { 0xAF, 0x32, 0x8D, 0x17, 0xFA, 0x28, 0x75, 0x3A, 0x3C, 0x9F, 0x5C, 0xB7, 0x2E, 0x37, 0x6B, 0x90, 0x44, 0x0B, 0x96, 0xF0, 0x28, 0x9E, 0x57, 0x03, 0xB7, 0x29, 0x32, 0x4A, 0x97, 0x5A, 0xB3, 0x84, 0xED, 0xA5, 0x65, 0xFC, 0x92, 0xAA, 0xDE, 0xD1, 0x43, 0x66, 0x99, 0x00, 0xD7, 0x61, 0x86, 0x16, 0x87, 0xAC, 0xDC, 0x0A, 0x5F, 0xFA, 0x35, 0x8B, 0xD0, 0x57, 0x1A, 0xAA, 0xD8, 0x0A, 0xCA, 0x68 },
        { 0xD1, 0xDB, 0x17, 0xB4, 0x74, 0x5B, 0x25, 0x5E, 0x5E, 0xB1, 0x59, 0xF6, 0x65, 0x93, 0xCC, 0x9C, 0x14, 0x38, 0x50, 0x97, 0x9F, 0xC7, 0xA3, 0x95, 0x17, 0x96, 0xAB, 0xA8, 0x01, 0x65, 0xAA, 0xB5, 0x36, 0xB4, 0x61, 0x74, 0xCE, 0x19, 0xE3, 0xF7, 0x07, 0xF0, 0xE5, 0xC6, 0x48, 0x7F, 0x5F, 0x03, 0x08, 0x4B, 0xC0, 0xEC, 0x94, 0x61, 0x69, 0x1E, 0xF2, 0x01, 0x13, 0xE4, 0x2A, 0xD2, 0x81, 0x63 },
        { 0x95, 0x24, 0xB9, 0xA5, 0x53, 0x6B, 0x91, 0x06, 0x95, 0x26, 0xB4, 0xF6, 0x19, 0x6B, 0x7E, 0x94, 0x75, 0xB4, 0xDA, 0x69, 0xE0, 0x1F, 0x0C, 0x85, 0x57, 0x97, 0xF2, 0x24, 0xCD, 0x73, 0x35, 0xDD, 0xB2, 0x86, 0xFD, 0x99, 0xB9, 0xB3, 0x2F, 0xFE, 0x33, 0xB5, 0x9A, 0xD4, 0x24, 0xCC, 0x17, 0x44, 0xF6, 0xEB, 0x59, 0x13, 0x7F, 0x5F, 0xB8, 0x60, 0x19, 0x32, 0xE8, 0xA8, 0xAF, 0x0A, 0xE9, 0x30 }
    };
    UNUSED(result_sha3_512);

    testbench::test_template<sha3_types>(
        [](auto test_value) -> void {
            constexpr static const unsigned long long int value = decltype(test_value)::value;

            gtl::sha3<value> sha3;
            for (unsigned int i = 0; i < data_count; ++i) {
                sha3.reset();
                sha3.consume(data[i], testbench::string_length(data[i]));
                sha3.finalise();
                typename gtl::sha3<value>::hash_type hash = sha3.get_hash();

                char hash_string[(2 * gtl::sha3<value>::hash_size) + 1] = {};
                char result_string[(2 * gtl::sha3<value>::hash_size) + 1] = {};
                for (size_t index = 0; index < gtl::sha3<value>::hash_size; ++index) {
                    snprintf(hash_string + (index * 2), 3, "%02X", hash.data[index]);
                    if constexpr (value == 224) {
                        snprintf(result_string + (index * 2), 3, "%02X", result_sha3_224[i][index]);
                    }
                    else if constexpr (value == 256) {
                        snprintf(result_string + (index * 2), 3, "%02X", result_sha3_256[i][index]);
                    }
                    else if constexpr (value == 384) {
                        snprintf(result_string + (index * 2), 3, "%02X", result_sha3_384[i][index]);
                    }
                    else if constexpr (value == 512) {
                        snprintf(result_string + (index * 2), 3, "%02X", result_sha3_512[i][index]);
                    }
                    else {
                        REQUIRE(false);
                    }
                }
                PRINT("%s == %s\n", hash_string, result_string);
                if constexpr (value == 224) {
                    REQUIRE(testbench::is_memory_same(hash.data, result_sha3_224[i], gtl::sha3<value>::hash_size) == true);
                }
                else if constexpr (value == 256) {
                    REQUIRE(testbench::is_memory_same(hash.data, result_sha3_256[i], gtl::sha3<value>::hash_size) == true);
                }
                else if constexpr (value == 384) {
                    REQUIRE(testbench::is_memory_same(hash.data, result_sha3_384[i], gtl::sha3<value>::hash_size) == true);
                }
                else if constexpr (value == 512) {
                    REQUIRE(testbench::is_memory_same(hash.data, result_sha3_512[i], gtl::sha3<value>::hash_size) == true);
                }
                else {
                    REQUIRE(false);
                }
            }
        }
    );
}

TEST(sha3, evaluate, hash_as_string) {
    constexpr static const unsigned int hash_count = 4;
    constexpr static const unsigned int data_count = 7;

    constexpr static const char* data[data_count] = {
        "",
        "a",
        "abc",
        "message digest",
        "abcdefghijklmnopqrstuvwxyz",
        "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",
        "12345678901234567890123456789012345678901234567890123456789012345678901234567890"
    };
    UNUSED(data);

    constexpr static const char* result[hash_count][data_count] = {
        { // 224
          "6B4E03423667DBB73B6E15454F0EB1ABD4597F9A1B078E3F5B5A6BC7",
          "9E86FF69557CA95F405F081269685B38E3A819B309EE942F482B6A8B",
          "E642824C3F8CF24AD09234EE7D3C766FC9A3A5168D0C94AD73B46FDF",
          "18768BB4C48EB7FC88E5DDB17EFCF2964ABD7798A39D86A4B4A1E4C8",
          "5CDECA81E123F87CAD96B9CBA999F16F6D41549608D4E0F4681B8239",
          "A67C289B8250A6F437A20137985D605589A8C163D45261B15419556E",
          "0526898E185869F91B3E2A76DD72A15DC6940A67C8164A044CD25CC8" },
        { // 256
          "A7FFC6F8BF1ED76651C14756A061D662F580FF4DE43B49FA82D80A4B80F8434A",
          "80084BF2FBA02475726FEB2CAB2D8215EAB14BC6BDD8BFB2C8151257032ECD8B",
          "3A985DA74FE225B2045C172D6BD390BD855F086E3E9D525B46BFE24511431532",
          "EDCDB2069366E75243860C18C3A11465ECA34BCE6143D30C8665CEFCFD32BFFD",
          "7CAB2DC765E21B241DBC1C255CE620B29F527C6D5E7F5F843E56288F0D707521",
          "A79D6A9DA47F04A3B9A9323EC9991F2105D4C78A7BC7BEEB103855A7A11DFB9F",
          "293E5CE4CE54EE71990AB06E511B7CCD62722B1BEB414F5FF65C8274E0F5BE1D" },
        { // 382
          "0C63A75B845E4F7D01107D852E4C2485C51A50AAAA94FC61995E71BBEE983A2AC3713831264ADB47FB6BD1E058D5F004",
          "1815F774F320491B48569EFEC794D249EEB59AAE46D22BF77DAFE25C5EDC28D7EA44F93EE1234AA88F61C91912A4CCD9",
          "EC01498288516FC926459F58E2C6AD8DF9B473CB0FC08C2596DA7CF0E49BE4B298D88CEA927AC7F539F1EDF228376D25",
          "D9519709F44AF73E2C8E291109A979DE3D61DC02BF69DEF7FBFFDFFFE662751513F19AD57E17D4B93BA1E484FC1980D5",
          "FED399D2217AAF4C717AD0C5102C15589E1C990CC2B9A5029056A7F7485888D6AB65DB2370077A5CADB53FC9280D278F",
          "D5B972302F5080D0830E0DE7B6B2CF383665A008F4C4F386A61112652C742D20CB45AA51BD4F542FC733E2719E999291",
          "3C213A17F514638ACB3BF17F109F3E24C16F9F14F085B52A2F2B81ADC0DB83DF1A58DB2CE013191B8BA72D8FAE7E2A5E" },
        { // 512
          "A69F73CCA23A9AC5C8B567DC185A756E97C982164FE25859E0D1DCC1475C80A615B2123AF1F5F94C11E3E9402C3AC558F500199D95B6D3E301758586281DCD26",
          "697F2D856172CB8309D6B8B97DAC4DE344B549D4DEE61EDFB4962D8698B7FA803F4F93FF24393586E28B5B957AC3D1D369420CE53332712F997BD336D09AB02A",
          "B751850B1A57168A5693CD924B6B096E08F621827444F70D884F5D0240D2712E10E116E9192AF3C91A7EC57647E3934057340B4CF408D5A56592F8274EEC53F0",
          "3444E155881FA15511F57726C7D7CFE80302A7433067B29D59A71415CA9DD141AC892D310BC4D78128C98FDA839D18D7F0556F2FE7ACB3C0CDA4BFF3A25F5F59",
          "AF328D17FA28753A3C9F5CB72E376B90440B96F0289E5703B729324A975AB384EDA565FC92AADED143669900D761861687ACDC0A5FFA358BD0571AAAD80ACA68",
          "D1DB17B4745B255E5EB159F66593CC9C143850979FC7A3951796ABA80165AAB536B46174CE19E3F707F0E5C6487F5F03084BC0EC9461691EF20113E42AD28163",
          "9524B9A5536B91069526B4F6196B7E9475B4DA69E01F0C855797F224CD7335DDB286FD99B9B32FFE33B59AD424CC1744F6EB59137F5FB8601932E8A8AF0AE930" }
    };
    UNUSED(result);

    testbench::test_template<sha3_types>(
        [](auto test_value) -> void {
            constexpr static const unsigned long long int value = decltype(test_value)::value;

            gtl::sha3<value> sha3;
            for (unsigned int i = 0; i < data_count; ++i) {
                sha3.reset();
                sha3.consume(data[i], testbench::string_length(data[i]));
                sha3.finalise();
                typename gtl::sha3<value>::hash_type hash = sha3.get_hash();

                unsigned long long int result_index = value == 512 ? 3 : value == 384 ? 2
                                                                     : value == 256   ? 1
                                                                                      : 0;

                PRINT("%s == %s\n", gtl::sha3<value>::hash_to_string(hash).hash, result[result_index][i]);
                REQUIRE(testbench::is_string_same(gtl::sha3<value>::hash_to_string(hash).hash, result[result_index][i]) == true);
            }
        }
    );
}

TEST(sha3, evaluate, partial_insert) {
    constexpr static const unsigned int data_count = 7;

    constexpr static const char* data1[data_count] = {
        "",
        "a",
        "",
        "message",
        "abcdefghijklm",
        "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",
        "123456789012345678901234567890123456789012345678901234567890"
    };
    UNUSED(data1);

    constexpr static const char* data2[data_count] = {
        "",
        "",
        "abc",
        " digest",
        "nopqrstuvwxyz",
        "",
        "12345678901234567890"
    };
    UNUSED(data2);

    constexpr static const unsigned char result_sha3_224[data_count][gtl::sha3<224>::hash_size] = {
        { 0x6B, 0x4E, 0x03, 0x42, 0x36, 0x67, 0xDB, 0xB7, 0x3B, 0x6E, 0x15, 0x45, 0x4F, 0x0E, 0xB1, 0xAB, 0xD4, 0x59, 0x7F, 0x9A, 0x1B, 0x07, 0x8E, 0x3F, 0x5B, 0x5A, 0x6B, 0xC7 },
        { 0x9E, 0x86, 0xFF, 0x69, 0x55, 0x7C, 0xA9, 0x5F, 0x40, 0x5F, 0x08, 0x12, 0x69, 0x68, 0x5B, 0x38, 0xE3, 0xA8, 0x19, 0xB3, 0x09, 0xEE, 0x94, 0x2F, 0x48, 0x2B, 0x6A, 0x8B },
        { 0xE6, 0x42, 0x82, 0x4C, 0x3F, 0x8C, 0xF2, 0x4A, 0xD0, 0x92, 0x34, 0xEE, 0x7D, 0x3C, 0x76, 0x6F, 0xC9, 0xA3, 0xA5, 0x16, 0x8D, 0x0C, 0x94, 0xAD, 0x73, 0xB4, 0x6F, 0xDF },
        { 0x18, 0x76, 0x8B, 0xB4, 0xC4, 0x8E, 0xB7, 0xFC, 0x88, 0xE5, 0xDD, 0xB1, 0x7E, 0xFC, 0xF2, 0x96, 0x4A, 0xBD, 0x77, 0x98, 0xA3, 0x9D, 0x86, 0xA4, 0xB4, 0xA1, 0xE4, 0xC8 },
        { 0x5C, 0xDE, 0xCA, 0x81, 0xE1, 0x23, 0xF8, 0x7C, 0xAD, 0x96, 0xB9, 0xCB, 0xA9, 0x99, 0xF1, 0x6F, 0x6D, 0x41, 0x54, 0x96, 0x08, 0xD4, 0xE0, 0xF4, 0x68, 0x1B, 0x82, 0x39 },
        { 0xA6, 0x7C, 0x28, 0x9B, 0x82, 0x50, 0xA6, 0xF4, 0x37, 0xA2, 0x01, 0x37, 0x98, 0x5D, 0x60, 0x55, 0x89, 0xA8, 0xC1, 0x63, 0xD4, 0x52, 0x61, 0xB1, 0x54, 0x19, 0x55, 0x6E },
        { 0x05, 0x26, 0x89, 0x8E, 0x18, 0x58, 0x69, 0xF9, 0x1B, 0x3E, 0x2A, 0x76, 0xDD, 0x72, 0xA1, 0x5D, 0xC6, 0x94, 0x0A, 0x67, 0xC8, 0x16, 0x4A, 0x04, 0x4C, 0xD2, 0x5C, 0xC8 }
    };
    UNUSED(result_sha3_224);

    constexpr static const unsigned char result_sha3_256[data_count][gtl::sha3<256>::hash_size] = {
        { 0xA7, 0xFF, 0xC6, 0xF8, 0xBF, 0x1E, 0xD7, 0x66, 0x51, 0xC1, 0x47, 0x56, 0xA0, 0x61, 0xD6, 0x62, 0xF5, 0x80, 0xFF, 0x4D, 0xE4, 0x3B, 0x49, 0xFA, 0x82, 0xD8, 0x0A, 0x4B, 0x80, 0xF8, 0x43, 0x4A },
        { 0x80, 0x08, 0x4B, 0xF2, 0xFB, 0xA0, 0x24, 0x75, 0x72, 0x6F, 0xEB, 0x2C, 0xAB, 0x2D, 0x82, 0x15, 0xEA, 0xB1, 0x4B, 0xC6, 0xBD, 0xD8, 0xBF, 0xB2, 0xC8, 0x15, 0x12, 0x57, 0x03, 0x2E, 0xCD, 0x8B },
        { 0x3A, 0x98, 0x5D, 0xA7, 0x4F, 0xE2, 0x25, 0xB2, 0x04, 0x5C, 0x17, 0x2D, 0x6B, 0xD3, 0x90, 0xBD, 0x85, 0x5F, 0x08, 0x6E, 0x3E, 0x9D, 0x52, 0x5B, 0x46, 0xBF, 0xE2, 0x45, 0x11, 0x43, 0x15, 0x32 },
        { 0xED, 0xCD, 0xB2, 0x06, 0x93, 0x66, 0xE7, 0x52, 0x43, 0x86, 0x0C, 0x18, 0xC3, 0xA1, 0x14, 0x65, 0xEC, 0xA3, 0x4B, 0xCE, 0x61, 0x43, 0xD3, 0x0C, 0x86, 0x65, 0xCE, 0xFC, 0xFD, 0x32, 0xBF, 0xFD },
        { 0x7C, 0xAB, 0x2D, 0xC7, 0x65, 0xE2, 0x1B, 0x24, 0x1D, 0xBC, 0x1C, 0x25, 0x5C, 0xE6, 0x20, 0xB2, 0x9F, 0x52, 0x7C, 0x6D, 0x5E, 0x7F, 0x5F, 0x84, 0x3E, 0x56, 0x28, 0x8F, 0x0D, 0x70, 0x75, 0x21 },
        { 0xA7, 0x9D, 0x6A, 0x9D, 0xA4, 0x7F, 0x04, 0xA3, 0xB9, 0xA9, 0x32, 0x3E, 0xC9, 0x99, 0x1F, 0x21, 0x05, 0xD4, 0xC7, 0x8A, 0x7B, 0xC7, 0xBE, 0xEB, 0x10, 0x38, 0x55, 0xA7, 0xA1, 0x1D, 0xFB, 0x9F },
        { 0x29, 0x3E, 0x5C, 0xE4, 0xCE, 0x54, 0xEE, 0x71, 0x99, 0x0A, 0xB0, 0x6E, 0x51, 0x1B, 0x7C, 0xCD, 0x62, 0x72, 0x2B, 0x1B, 0xEB, 0x41, 0x4F, 0x5F, 0xF6, 0x5C, 0x82, 0x74, 0xE0, 0xF5, 0xBE, 0x1D }
    };
    UNUSED(result_sha3_256);

    constexpr static const unsigned char result_sha3_384[data_count][gtl::sha3<384>::hash_size] = {
        { 0x0C, 0x63, 0xA7, 0x5B, 0x84, 0x5E, 0x4F, 0x7D, 0x01, 0x10, 0x7D, 0x85, 0x2E, 0x4C, 0x24, 0x85, 0xC5, 0x1A, 0x50, 0xAA, 0xAA, 0x94, 0xFC, 0x61, 0x99, 0x5E, 0x71, 0xBB, 0xEE, 0x98, 0x3A, 0x2A, 0xC3, 0x71, 0x38, 0x31, 0x26, 0x4A, 0xDB, 0x47, 0xFB, 0x6B, 0xD1, 0xE0, 0x58, 0xD5, 0xF0, 0x04 },
        { 0x18, 0x15, 0xF7, 0x74, 0xF3, 0x20, 0x49, 0x1B, 0x48, 0x56, 0x9E, 0xFE, 0xC7, 0x94, 0xD2, 0x49, 0xEE, 0xB5, 0x9A, 0xAE, 0x46, 0xD2, 0x2B, 0xF7, 0x7D, 0xAF, 0xE2, 0x5C, 0x5E, 0xDC, 0x28, 0xD7, 0xEA, 0x44, 0xF9, 0x3E, 0xE1, 0x23, 0x4A, 0xA8, 0x8F, 0x61, 0xC9, 0x19, 0x12, 0xA4, 0xCC, 0xD9 },
        { 0xEC, 0x01, 0x49, 0x82, 0x88, 0x51, 0x6F, 0xC9, 0x26, 0x45, 0x9F, 0x58, 0xE2, 0xC6, 0xAD, 0x8D, 0xF9, 0xB4, 0x73, 0xCB, 0x0F, 0xC0, 0x8C, 0x25, 0x96, 0xDA, 0x7C, 0xF0, 0xE4, 0x9B, 0xE4, 0xB2, 0x98, 0xD8, 0x8C, 0xEA, 0x92, 0x7A, 0xC7, 0xF5, 0x39, 0xF1, 0xED, 0xF2, 0x28, 0x37, 0x6D, 0x25 },
        { 0xD9, 0x51, 0x97, 0x09, 0xF4, 0x4A, 0xF7, 0x3E, 0x2C, 0x8E, 0x29, 0x11, 0x09, 0xA9, 0x79, 0xDE, 0x3D, 0x61, 0xDC, 0x02, 0xBF, 0x69, 0xDE, 0xF7, 0xFB, 0xFF, 0xDF, 0xFF, 0xE6, 0x62, 0x75, 0x15, 0x13, 0xF1, 0x9A, 0xD5, 0x7E, 0x17, 0xD4, 0xB9, 0x3B, 0xA1, 0xE4, 0x84, 0xFC, 0x19, 0x80, 0xD5 },
        { 0xFE, 0xD3, 0x99, 0xD2, 0x21, 0x7A, 0xAF, 0x4C, 0x71, 0x7A, 0xD0, 0xC5, 0x10, 0x2C, 0x15, 0x58, 0x9E, 0x1C, 0x99, 0x0C, 0xC2, 0xB9, 0xA5, 0x02, 0x90, 0x56, 0xA7, 0xF7, 0x48, 0x58, 0x88, 0xD6, 0xAB, 0x65, 0xDB, 0x23, 0x70, 0x07, 0x7A, 0x5C, 0xAD, 0xB5, 0x3F, 0xC9, 0x28, 0x0D, 0x27, 0x8F },
        { 0xD5, 0xB9, 0x72, 0x30, 0x2F, 0x50, 0x80, 0xD0, 0x83, 0x0E, 0x0D, 0xE7, 0xB6, 0xB2, 0xCF, 0x38, 0x36, 0x65, 0xA0, 0x08, 0xF4, 0xC4, 0xF3, 0x86, 0xA6, 0x11, 0x12, 0x65, 0x2C, 0x74, 0x2D, 0x20, 0xCB, 0x45, 0xAA, 0x51, 0xBD, 0x4F, 0x54, 0x2F, 0xC7, 0x33, 0xE2, 0x71, 0x9E, 0x99, 0x92, 0x91 },
        { 0x3C, 0x21, 0x3A, 0x17, 0xF5, 0x14, 0x63, 0x8A, 0xCB, 0x3B, 0xF1, 0x7F, 0x10, 0x9F, 0x3E, 0x24, 0xC1, 0x6F, 0x9F, 0x14, 0xF0, 0x85, 0xB5, 0x2A, 0x2F, 0x2B, 0x81, 0xAD, 0xC0, 0xDB, 0x83, 0xDF, 0x1A, 0x58, 0xDB, 0x2C, 0xE0, 0x13, 0x19, 0x1B, 0x8B, 0xA7, 0x2D, 0x8F, 0xAE, 0x7E, 0x2A, 0x5E }
    };
    UNUSED(result_sha3_384);

    constexpr static const unsigned char result_sha3_512[data_count][gtl::sha3<512>::hash_size] = {
        { 0xA6, 0x9F, 0x73, 0xCC, 0xA2, 0x3A, 0x9A, 0xC5, 0xC8, 0xB5, 0x67, 0xDC, 0x18, 0x5A, 0x75, 0x6E, 0x97, 0xC9, 0x82, 0x16, 0x4F, 0xE2, 0x58, 0x59, 0xE0, 0xD1, 0xDC, 0xC1, 0x47, 0x5C, 0x80, 0xA6, 0x15, 0xB2, 0x12, 0x3A, 0xF1, 0xF5, 0xF9, 0x4C, 0x11, 0xE3, 0xE9, 0x40, 0x2C, 0x3A, 0xC5, 0x58, 0xF5, 0x00, 0x19, 0x9D, 0x95, 0xB6, 0xD3, 0xE3, 0x01, 0x75, 0x85, 0x86, 0x28, 0x1D, 0xCD, 0x26 },
        { 0x69, 0x7F, 0x2D, 0x85, 0x61, 0x72, 0xCB, 0x83, 0x09, 0xD6, 0xB8, 0xB9, 0x7D, 0xAC, 0x4D, 0xE3, 0x44, 0xB5, 0x49, 0xD4, 0xDE, 0xE6, 0x1E, 0xDF, 0xB4, 0x96, 0x2D, 0x86, 0x98, 0xB7, 0xFA, 0x80, 0x3F, 0x4F, 0x93, 0xFF, 0x24, 0x39, 0x35, 0x86, 0xE2, 0x8B, 0x5B, 0x95, 0x7A, 0xC3, 0xD1, 0xD3, 0x69, 0x42, 0x0C, 0xE5, 0x33, 0x32, 0x71, 0x2F, 0x99, 0x7B, 0xD3, 0x36, 0xD0, 0x9A, 0xB0, 0x2A },
        { 0xB7, 0x51, 0x85, 0x0B, 0x1A, 0x57, 0x16, 0x8A, 0x56, 0x93, 0xCD, 0x92, 0x4B, 0x6B, 0x09, 0x6E, 0x08, 0xF6, 0x21, 0x82, 0x74, 0x44, 0xF7, 0x0D, 0x88, 0x4F, 0x5D, 0x02, 0x40, 0xD2, 0x71, 0x2E, 0x10, 0xE1, 0x16, 0xE9, 0x19, 0x2A, 0xF3, 0xC9, 0x1A, 0x7E, 0xC5, 0x76, 0x47, 0xE3, 0x93, 0x40, 0x57, 0x34, 0x0B, 0x4C, 0xF4, 0x08, 0xD5, 0xA5, 0x65, 0x92, 0xF8, 0x27, 0x4E, 0xEC, 0x53, 0xF0 },
        { 0x34, 0x44, 0xE1, 0x55, 0x88, 0x1F, 0xA1, 0x55, 0x11, 0xF5, 0x77, 0x26, 0xC7, 0xD7, 0xCF, 0xE8, 0x03, 0x02, 0xA7, 0x43, 0x30, 0x67, 0xB2, 0x9D, 0x59, 0xA7, 0x14, 0x15, 0xCA, 0x9D, 0xD1, 0x41, 0xAC, 0x89, 0x2D, 0x31, 0x0B, 0xC4, 0xD7, 0x81, 0x28, 0xC9, 0x8F, 0xDA, 0x83, 0x9D, 0x18, 0xD7, 0xF0, 0x55, 0x6F, 0x2F, 0xE7, 0xAC, 0xB3, 0xC0, 0xCD, 0xA4, 0xBF, 0xF3, 0xA2, 0x5F, 0x5F, 0x59 },
        { 0xAF, 0x32, 0x8D, 0x17, 0xFA, 0x28, 0x75, 0x3A, 0x3C, 0x9F, 0x5C, 0xB7, 0x2E, 0x37, 0x6B, 0x90, 0x44, 0x0B, 0x96, 0xF0, 0x28, 0x9E, 0x57, 0x03, 0xB7, 0x29, 0x32, 0x4A, 0x97, 0x5A, 0xB3, 0x84, 0xED, 0xA5, 0x65, 0xFC, 0x92, 0xAA, 0xDE, 0xD1, 0x43, 0x66, 0x99, 0x00, 0xD7, 0x61, 0x86, 0x16, 0x87, 0xAC, 0xDC, 0x0A, 0x5F, 0xFA, 0x35, 0x8B, 0xD0, 0x57, 0x1A, 0xAA, 0xD8, 0x0A, 0xCA, 0x68 },
        { 0xD1, 0xDB, 0x17, 0xB4, 0x74, 0x5B, 0x25, 0x5E, 0x5E, 0xB1, 0x59, 0xF6, 0x65, 0x93, 0xCC, 0x9C, 0x14, 0x38, 0x50, 0x97, 0x9F, 0xC7, 0xA3, 0x95, 0x17, 0x96, 0xAB, 0xA8, 0x01, 0x65, 0xAA, 0xB5, 0x36, 0xB4, 0x61, 0x74, 0xCE, 0x19, 0xE3, 0xF7, 0x07, 0xF0, 0xE5, 0xC6, 0x48, 0x7F, 0x5F, 0x03, 0x08, 0x4B, 0xC0, 0xEC, 0x94, 0x61, 0x69, 0x1E, 0xF2, 0x01, 0x13, 0xE4, 0x2A, 0xD2, 0x81, 0x63 },
        { 0x95, 0x24, 0xB9, 0xA5, 0x53, 0x6B, 0x91, 0x06, 0x95, 0x26, 0xB4, 0xF6, 0x19, 0x6B, 0x7E, 0x94, 0x75, 0xB4, 0xDA, 0x69, 0xE0, 0x1F, 0x0C, 0x85, 0x57, 0x97, 0xF2, 0x24, 0xCD, 0x73, 0x35, 0xDD, 0xB2, 0x86, 0xFD, 0x99, 0xB9, 0xB3, 0x2F, 0xFE, 0x33, 0xB5, 0x9A, 0xD4, 0x24, 0xCC, 0x17, 0x44, 0xF6, 0xEB, 0x59, 0x13, 0x7F, 0x5F, 0xB8, 0x60, 0x19, 0x32, 0xE8, 0xA8, 0xAF, 0x0A, 0xE9, 0x30 }
    };
    UNUSED(result_sha3_512);

    testbench::test_template<sha3_types>(
        [](auto test_value) -> void {
            constexpr static const unsigned long long int value = decltype(test_value)::value;

            gtl::sha3<value> sha3;

            for (unsigned int i = 0; i < data_count; ++i) {
                sha3.reset();
                sha3.consume(data1[i], testbench::string_length(data1[i]));
                sha3.consume(data2[i], testbench::string_length(data2[i]));
                sha3.finalise();
                typename gtl::sha3<value>::hash_type hash = sha3.get_hash();

                char hash_string[(2 * gtl::sha3<value>::hash_size) + 1] = {};
                char result_string[(2 * gtl::sha3<value>::hash_size) + 1] = {};
                for (size_t index = 0; index < gtl::sha3<value>::hash_size; ++index) {
                    snprintf(hash_string + (index * 2), 3, "%02X", hash.data[index]);
                    if constexpr (value == 224) {
                        snprintf(result_string + (index * 2), 3, "%02X", result_sha3_224[i][index]);
                    }
                    else if constexpr (value == 256) {
                        snprintf(result_string + (index * 2), 3, "%02X", result_sha3_256[i][index]);
                    }
                    else if constexpr (value == 384) {
                        snprintf(result_string + (index * 2), 3, "%02X", result_sha3_384[i][index]);
                    }
                    else if constexpr (value == 512) {
                        snprintf(result_string + (index * 2), 3, "%02X", result_sha3_512[i][index]);
                    }
                    else {
                        REQUIRE(false);
                    }
                }
                PRINT("%s == %s\n", hash_string, result_string);
                if constexpr (value == 224) {
                    REQUIRE(testbench::is_memory_same(hash.data, result_sha3_224[i], gtl::sha3<value>::hash_size) == true);
                }
                else if constexpr (value == 256) {
                    REQUIRE(testbench::is_memory_same(hash.data, result_sha3_256[i], gtl::sha3<value>::hash_size) == true);
                }
                else if constexpr (value == 384) {
                    REQUIRE(testbench::is_memory_same(hash.data, result_sha3_384[i], gtl::sha3<value>::hash_size) == true);
                }
                else if constexpr (value == 512) {
                    REQUIRE(testbench::is_memory_same(hash.data, result_sha3_512[i], gtl::sha3<value>::hash_size) == true);
                }
                else {
                    REQUIRE(false);
                }
            }
        }
    );
}
